_format_version: '2.1'
_transform: true

plugins:
  - name: key-auth
    config:
      key_names:
        - apikey
  - name: rate-limiting
    config:
      minute: 300
      policy: local
  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
      headers:
        - Authorization
        - Content-Type
      exposed_headers:
        - X-Total-Count
      max_age: 3600
      credentials: true
  - name: request-transformer
    config:
      remove:
        headers:
          - user-agent
          - accept-encoding
      add:
        headers:
          - "X-Request-ID: $uuid"
          - "X-Request-Timestamp: $date"
      append:
        headers:
          - "X-Request-User: $user"
  - name: response-transformer
    config:
      remove:
        headers:
          - server
          - x-powered-by
      add:
        headers:
          - "X-Response-ID: $uuid"
          - "X-Response-Timestamp: $date"
      append:
        headers:
          - "X-Response-User: $user"

services:
  - name: gateway-service
    url: http://gateway-service:8080